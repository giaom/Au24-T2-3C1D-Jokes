@{
    ViewData["Title"] = "Home Page";
}

<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="~/css/site.css" />
    <style>
        .highlight-white {
            background-color: white; /* White background */
            color: #9409f7; /* Purple text color */
            padding: 2px 4px; /* Optional padding for better visibility */
            border-radius: 3px; /* Optional rounded corners */
        }
        .form-inline .form-control {
            width: auto;
            flex: 1;
        }
        .form-inline .btn {
            width: 150px; /* Adjust the width as needed */
        }
        .form-group-inline {
            display: flex;
            align-items: center;
        }
        .form-group-inline input {
            flex: 2;
            margin-right: 10px;
        }
        .form-group-inline button {
            flex: none;
        }
        .short-label {
            flex: 0 0 150px; /* Adjust the width as needed */
        }
    </style>
</head>

<body class="home-page">
    <div class="text-center">
        <h1 class="display-4 mb-4">Welcome to the Home Page!</h1> <!-- Added mb-4 for margin-bottom -->
    </div>

    <div class="text-center">
        <form id="jokeForm" class="mx-auto" style="max-width: 600px;">
            @Html.AntiForgeryToken()
            <div class="form-group mb-4"> <!-- Added mb-4 for margin-bottom -->
                <label for="Text">Joke Text</label>
                <input type="text" class="form-control" id="Text" name="Text" required />
            </div>

            <div class="form-group mb-4"> <!-- Added mb-4 for margin-bottom -->
                <label for="Author">Author</label>
                <input type="text" class="form-control" id="Author" name="Author" required />
            </div>

            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>

    @if (!string.IsNullOrEmpty(ViewData["SuccessMessage"] as string))
    {
        <div class="text-center">
            <div class="alert alert-success mt-3">
                @ViewData["SuccessMessage"]
            </div>
        </div>
    }

    <!-- Displaying the jokes with delete option -->
    <div class="text-center mt-5">
        <div id="jokesList">
            <!-- Jokes will be appended here dynamically -->
        </div>
    </div>

    <!-- Find Joke by ID -->
    <div class="mt-5 mx-auto" style="max-width: 600px;">
        <form id="findJokeForm" class="left-align">
            <div class="form-group">
                <label for="jokeIdToFind" class="highlight-white short-label">Joke ID</label>
                <div class="form-group-inline">
                    <input type="text" class="form-control" id="jokeIdToFind" name="jokeIdToFind"
                        placeholder="Enter joke ID to find" required />
                    <button type="submit" class="btn btn-info">Find Joke</button>
                </div>
            </div>
        </form>

        <div id="foundJoke" class="mt-3">
            <!-- Found joke will be displayed here -->
        </div>
    </div>

    <!-- Remove Joke by ID -->
    <div class="mt-5 mx-auto" style="max-width: 600px;">
        <form id="removeJokeForm" class="left-align">
            <div class="form-group">
                <label for="jokeIdToRemove" class="highlight-white short-label">Joke ID</label>
                <div class="form-group-inline">
                    <input type="text" class="form-control" id="jokeIdToRemove" name="jokeIdToRemove"
                        placeholder="Enter joke ID to remove" required />
                    <button type="submit" class="btn btn-danger">Remove Joke</button>
                </div>
            </div>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Function to fetch all jokes and display them
        function loadJokes() {
            $.ajax({
                url: '/api/jokes',  // Endpoint to fetch all jokes
                type: 'GET',
                success: function (response) {
                    $('#jokesList').empty();  // Clear existing jokes
                    response.forEach(function (joke) {
                        $('#jokesList').append(`
                            <div class="joke-item" data-id="${joke.id}">
                                <p><strong>${joke.text}</strong></p>
                                <p><em>by ${joke.author}</em></p>
                                <button class="btn btn-danger delete-btn">Remove</button>
                            </div>
                        `);
                    });
                },
                error: function () {
                    alert('Error fetching jokes');
                }
            });
        }

        // Submit the joke form (POST request to add a new joke)
        $('#jokeForm').submit(function (e) {
            e.preventDefault(); // Prevent default form submission

            var jokeData = {
                Text: $('#Text').val(),
                Author: $('#Author').val()
            };

            $.ajax({
                url: '/api/jokes',  // Correct URL to your API endpoint
                type: 'POST',
                data: JSON.stringify(jokeData),
                contentType: 'application/json', // Send data as JSON
                headers: {
                    'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val() // For CSRF protection
                },
                success: function (response) {
                    alert('Joke added successfully');
                    loadJokes(); // Reload the jokes list after adding
                    $('#jokeForm')[0].reset(); // Reset the form
                },
                error: function () {
                    alert('Error adding joke');
                }
            });
        });

        // Delete a joke (remove it from the list and the database) when the "Remove" button is clicked
        $(document).on('click', '.delete-btn', function () {
            var jokeId = $(this).closest('.joke-item').data('id');

            $.ajax({
                url: '/api/jokes/remove/' + jokeId,  // Delete endpoint with joke ID
                type: 'DELETE',
                success: function () {
                    alert('Joke removed successfully');
                    loadJokes(); // Reload the jokes list after removal
                },
                error: function () {
                    alert('Error removing joke');
                }
            });
        });

        // Handle the removal of a joke by ID entered in the form
        $('#removeJokeForm').submit(function (e) {
            e.preventDefault(); // Prevent form submission

            var jokeId = $('#jokeIdToRemove').val(); // Get the entered joke ID

            if (!jokeId) {
                alert('Please enter a joke ID');
                return;
            }

            $.ajax({
                url: '/api/jokes/remove/' + jokeId,  // Delete endpoint with joke ID
                type: 'DELETE',
                success: function () {
                    alert('Joke removed successfully');
                    loadJokes(); // Reload the jokes list after removal
                },
                error: function () {
                    alert('Error removing joke');
                }
            });
        });

        // Handle the find joke by ID form submission
        $('#findJokeForm').submit(function (e) {
            e.preventDefault(); // Prevent form submission

            var jokeId = $('#jokeIdToFind').val(); // Get the entered joke ID

            if (!jokeId) {
                alert('Please enter a joke ID');
                return;
            }

            $.ajax({
                url: '/api/jokes/' + jokeId,  // Get joke by ID
                type: 'GET',
                success: function (response) {
                    $('#foundJoke').html(`
                        <div class="alert alert-info">
                            <p><strong>${response.text}</strong></p>
                            <p><em>by ${response.author}</em></p>
                        </div>
                    `);
                },
                error: function () {
                    $('#foundJoke').html('<div class="alert alert-danger">Joke not found.</div>');
                }
            });
        });

        // Initial load of jokes when the page is ready
        $(document).ready(function () {
            loadJokes(); // Load jokes on page load
        });
    </script>
</body>

</html>